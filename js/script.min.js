function calculateReport(){var e=$("#inpPrinRemain").val();var t=$("#inpEmi").val();var n=$("#inpInterest").val();var r=validateInputs(e,t,n);setErrorMsg(r);if(r!==""){return}var i=parseFloat(e);var s=parseFloat(t);var o=parseFloat(n);var u=$("#inpStartDate").val();var a=u.slice(0,2);var f=u.slice(2);var l=$("#repaymentTable table tbody");var c=calculateLoanSchedule(i,s,o,new Date(f,a-1,1));g_report.origTotAmount=calculateTotalAmount(c);g_report.origTotMonths=c.length;pieChart=new google.visualization.PieChart($("#chart_div")[0]);colChart=new google.visualization.ColumnChart($("#bar_chart_div")[0]);displayTable(l,c);$("#inpPrinRemain").focus();$("#inpPrinRemain").select();return c}function validateInputs(e,t,n){var r="";if(e.match(/^ *$/)&&t.match(/^ *$/)&&n.match(/^ *$/)){r="All input fields are mandatory";return r}if(e.match(/^ *$/)){r="Principal Remaining field is mandatory";return r}if(t.match(/^ *$/)){r="EMI field is mandatory";return r}if(n.match(/^ *$/)){r="Interest field is mandatory";return r}if(!e.match(/^-?[0-9]*\.?[0-9]*$/)){r="Principal Remaining is not numeric";return r}if(!t.match(/^-?[0-9]*\.?[0-9]*$/)){r="EMI is not numeric";return r}if(!n.match(/^-?[0-9]*\.?[0-9]*$/)){r="Interest is not numeric";return r}if(e.match(/^-/)){r="Principal Remaining should be positive";return r}if(t.match(/^-/)){r="EMI should be positive";return r}if(n.match(/^-/)){r="Interest should be positive";return r}var i=parseFloat(e);var s=parseFloat(t);var o=parseFloat(n);var u=$("#inpStartDate").val();var a=u.slice(0,2);var f=u.slice(2);if(o>100){r="Interest should be less than 100%";return r}if(i*o*.01/12>=s){r="Negative Amortization... EMI has to be more than "+(i*o*.01/12).toFixed(2);return r}return r}function setErrorMsg(e){$(".errorMsg span").html(e);if(e===""){$(".errorMsg").hide();$(".userBody").show()}else{$(".errorMsg").show();$(".userBody").hide()}}function numberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}var month_names=[];month_names[month_names.length]="Jan";month_names[month_names.length]="Feb";month_names[month_names.length]="Mar";month_names[month_names.length]="Apr";month_names[month_names.length]="May";month_names[month_names.length]="Jun";month_names[month_names.length]="Jul";month_names[month_names.length]="Aug";month_names[month_names.length]="Sep";month_names[month_names.length]="Oct";month_names[month_names.length]="Nov";month_names[month_names.length]="Dec";google.load("visualization","1.0",{packages:["corechart"]});var pieChart,colChart;var g_report={};$(document).ready(function(){var e=[];$("#btnCalculate").click(function(t){e=calculateReport();_gaq.push(["_trackEvent","Calculate","Click"])});$("#dataChangeModal").on("hidden.bs.modal",function(){var e=parseInt($("#labelMonthNumber").text());$("#repaymentTable tbody tr:nth-child("+e+")").removeClass("active");$("#dataChangeModal input").removeClass("green")});$("#dataChangeModal").on("shown.bs.modal",function(){$("#inpChangeEMI").focus();$("#inpChangeEMI").select()});$("#btnChangeUndoChange").click(function(){var t=parseInt($("#labelMonthNumber").text()-1);e[t].changed=0;e[t].prePayment=0;e[t].addLoan=0;var n=parseFloat($("#inpEmi").val());var r=parseFloat($("#inpInterest").val());var i=parseFloat($("#inpPrinRemain").val());var s=recalculateLoanSchedule(e,i,r,n);var o=$("#repaymentTable table tbody");$("#dataChangeModal").modal("toggle");displayTable(o,e)});$("#btnChangeSave").click(function(){_gaq.push(["_trackEvent","ModifiedTable","Changed"]);var t=1;var n=2;var r=4;var i=8;var s=0;var o=parseInt($("#labelMonthNumber").text()-1);s=e[o].changed;if(e[o].emi.toFixed(2)!=$("#inpChangeEMI").val()){_gaq.push(["_trackEvent","ModifiedEMI","Changed"]);s=s|t;e[o].emi=parseFloat($("#inpChangeEMI").val())}if(e[o].roi.toFixed(2)!=$("#inpChangeInterest").val()){_gaq.push(["_trackEvent","ModifiedInterest","Changed"]);s=s|n;e[o].roi=parseFloat($("#inpChangeInterest").val())}if(parseFloat($("#inpChangeAddPrePayment").val())!=0){_gaq.push(["_trackEvent","ModifiedPrePay","Changed"]);s=s|r;e[o].prePayment=parseFloat($("#inpChangeAddPrePayment").val())}if(parseFloat($("#inpChangeAddLoan").val())!=0){_gaq.push(["_trackEvent","ModifiedAddLoan","Changed"]);s=s|i;e[o].addLoan=parseFloat($("#inpChangeAddLoan").val())}e[o].changed=s;var u=parseFloat($("#inpEmi").val());var a=parseFloat($("#inpInterest").val());var f=parseFloat($("#inpPrinRemain").val());var l=recalculateLoanSchedule(e,f,a,u);if(l!==""){alert(l)}var c=$("#repaymentTable table tbody");$("#dataChangeModal").modal("toggle");displayTable(c,e)});$(".date-picker").datepicker({changeMonth:true,changeYear:true,showButtonPanel:true,dateFormat:"mmyy",onClose:function(e,t){var n=$("#ui-datepicker-div .ui-datepicker-month :selected").val();var r=$("#ui-datepicker-div .ui-datepicker-year :selected").val();$(this).datepicker("setDate",new Date(r,n,1))}});$(".inputForm input").keypress(function(e){if(e.which==13){$("#btnCalculate").focus().click();$(this).focus().select()}});$("#dataChangeModal input").keypress(function(e){if(e.which==13){$("#btnChangeSave").focus().click()}});$("#inpPrinRemain").val("1000000");$("#inpEmi").val("13494");$("#inpInterest").val("10.5");$("#inpStartDate").val("012013");e=calculateReport();g_report.emiArray=e;$("#demoVideoModal").on("shown.bs.modal",function(){_gaq.push(["_trackEvent","DemoVideo","Click"]);var e=$(".demoVideoContainer iframe");var t=$(".demoVideoContainer").width();e.width(t).height(t/1.33)});$("#surveyModal").on("shown.bs.modal",function(){_gaq.push(["_trackEvent","Survey","Click"])});$("#btnUndoAllModifications").click(function(){_gaq.push(["_trackEvent","UndoAllMod","Click"]);for(var t=0;t<e.length;t++){e[t].changed=0;e[t].prePayment=0;e[t].addLoan=0}var n=parseFloat($("#inpEmi").val());var r=parseFloat($("#inpInterest").val());var i=parseFloat($("#inpPrinRemain").val());var s=recalculateLoanSchedule(e,i,r,n);var o=$("#repaymentTable table tbody");displayTable(o,e)})});var displayTable=function(e,t){var n="";for(var r=0;r<t.length;r++){if(t[r].changed){n+='<tr class="success">'}else{n+="<tr>"}n+="<td>"+(r+1)+"</td>";n+="<td>"+month_names[t[r].month.getMonth()]+" "+t[r].month.getFullYear()+"</td>";n+="<td>"+t[r].principalRem.toFixed(2)+"</td>";n+="<td>"+t[r].emiPrin.toFixed(2)+"</td>";n+="<td>"+t[r].emiInt.toFixed(2)+"</td>";n+="</tr>"}e.html(n);$("#repaymentTable tbody tr").click(function(e){var n=this.rowIndex;var r=1;var i=2;var s=4;var o=8;var u=t[n].changed;if((u&r)==r){$("#inpChangeEMI").addClass("green")}if((u&i)==i){$("#inpChangeInterest").addClass("green")}if((u&s)==s){$("#inpChangeAddPrePayment").addClass("green")}if((u&o)==o){$("#inpChangeAddLoan").addClass("green")}$(this).toggleClass("active");$("#labelMonthNumber").html(n+1);$("#labelMonth").html(month_names[t[n].month.getMonth()]+" "+t[n].month.getFullYear());$("#inpChangeEMI").val(t[n].emi.toFixed(2));$("#inpChangeInterest").val(t[n].roi.toFixed(2));$("#inpChangeAddPrePayment").val(t[n].prePayment.toFixed(2));$("#inpChangeAddLoan").val(t[n].addLoan.toFixed(2));$("#dataChangeModal").modal("toggle")});$("#repaymentTable tbody tr").popover({placement:"bottom",trigger:"hover",html:true,title:"Click Row to edit",content:function(){return $("#rowPopover").html()}});$("#repaymentTable tbody tr").on("show.bs.popover",function(){$("#rowPopover span").removeClass("green");var e=this.rowIndex;var n=1;var r=2;var i=4;var s=8;var o=t[e].changed;$("#popEMI").text(t[e].emi.toFixed(2));$("#popInterest").text(t[e].roi.toFixed(2));$("#popPrePay").text(t[e].prePayment.toFixed(2));$("#popAddLoan").text(t[e].addLoan.toFixed(2));if((o&n)==n){$("#popEMI").addClass("green")}if((o&r)==r){$("#popInterest").addClass("green")}if((o&i)==i){$("#popPrePay").addClass("green")}if((o&s)==s){$("#popAddLoan").addClass("green")}});var i="No. of months: "+t.length+' Last EMI is <span class="emphasize">'+month_names[t[t.length-1].month.getMonth()]+" "+t[t.length-1].month.getFullYear()+".</span> ";$("#totLastEmiMsg").text(month_names[t[t.length-1].month.getMonth()]+" "+t[t.length-1].month.getFullYear());var s=0;var o=0;for(r=0;r<t.length;r++){s+=t[r].emiPrin;o+=t[r].emiInt}$("#totPrinMsg").text(numberWithCommas(Math.round(s*100)/100));$("#totIntMsg").text(numberWithCommas(Math.round(o*100)/100));$("#totPrinPlusIntMsg").text(numberWithCommas(Math.round((s+o)*100)/100));var u=getTotalPrepay(t);$("#totPrePaymentMsg").text(numberWithCommas(Math.round(u*100)/100));if(u>0){$("#totPrePaymentMsg").addClass("green")}else{$("#totPrePaymentMsg").removeClass("green")}if(g_report.origTotAmount>0){var a=Math.round((g_report.origTotAmount-s-o)*100)/100;$("#totSaveMsg").text(numberWithCommas(a));if(a>0){$("#totSaveMsg").addClass("green")}else{$("#totSaveMsg").removeClass("green")}}var f=g_report.origTotMonths-t.length;if(f<=0){$("#totEmiMonthsMsg").text(t.length+" (+"+(0-f)+")");$("#totEmiMonthsMsg").removeClass("green");$("#totLastEmiMsg").removeClass("green")}else{$("#totEmiMonthsMsg").addClass("green");$("#totLastEmiMsg").addClass("green");$("#totEmiMonthsMsg").text(t.length+" ("+(0-f)+")")}var l="";if(f>=12){l=Math.floor(f/12)+" yr, "+f%12+" mnth"}else{l=f+" month(s)"}$("#totMonthsSaveMsg").text(l);if(f>0){$("#totMonthsSaveMsg").addClass("green")}else{$("#totMonthsSaveMsg").removeClass("green")}var c=new google.visualization.DataTable;c.addColumn("string","Repayment Component");c.addColumn("number","Rupee");c.addRows([["Interest",Math.round(o*100)/100],["Principal",Math.round(s*100)/100]]);var h={title:"Repayment Component",is3D:true,colors:["#990134","#336699"],titleTextStyle:{fontSize:12}};pieChart.draw(c,h);var p=$("#bar_chart_div");drawColumnChart(p[0],t)};var drawColumnChart=function(e,t){var n=[[]];n[0][0]="Year";n[0][1]="Intrst";n[0][2]="Prin";var r=t[0].month.getFullYear();var i=0;var s=0;for(var o=0;o<t.length;o++){if(t[o].month.getFullYear()==r){i+=t[o].emiPrin;s+=t[o].emiInt}else{n.push([r+"",Math.round(s*100)/100,Math.round(i*100)/100]);r=t[o].month.getFullYear();s=0;i=0}}n.push([r+"",Math.round(s*100)/100,Math.round(i*100)/100]);var u=google.visualization.arrayToDataTable(n);var a={title:"Yearwise Principal & Interest",hAxis:{title:"Year",titleTextStyle:{color:"#336699"}},colors:["#990134","#336699"],animation:{duration:1e3,easing:"linear"},titleTextStyle:{fontSize:12}};colChart.draw(u,a)}